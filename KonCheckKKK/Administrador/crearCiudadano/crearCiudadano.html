<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Crear Ciudadano - KonCheck</title>
  <style>
    /* Reset b√°sico */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Segoe UI", sans-serif;
    }

    /* Contenedor general */
    .main-container {
      display: flex;
      height: 105vh;
      width: 99vw;
      background-color: #00839a; /* Azul principal */
    }

    /* Panel izquierdo (azul) */
    .sidebar {
      width: 260px;
      background-color: #00839a;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 20px;
      color: white;
    }

    /* Secci√≥n del logo */
    .logo-section {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo {
      width: 45px;
      height: 45px;
    }

    .app-name {
      font-size: 20px;
      font-weight: 600;
      line-height: 1.1;
     text-shadow:  2px 2px 4px rgba(0, 0, 0, 0.7),   /* sombra negra principal */
    -1px -1px 2px rgba(255, 255, 255, 0.2); /* ligero brillo para resaltar */
    }

    /* Bot√≥n "Ciudadanos" */
    .menu-button {
      background-color: white;
      color: #00839a;
      border: none;
      border-radius: 20px;
      padding: 8px 35px;
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      width: fit-content;
      margin-top: 30px;
      transition: background-color 0.3s ease;
      margin-left: 70px;
    }

  /* üîπ Solo esto cambia: mover el icono y texto m√°s a la izquierda */
    .menu-button .icon {
      margin-left: -10px;
    }

    .menu-button:hover {
      background-color: #e5e5e5;
           text-shadow:  2px 2px 4px rgba(0, 0, 0, 0.7),   /* sombra negra principal */
    -1px -1px 2px rgba(255, 255, 255, 0.2); /* ligero brillo para resaltar */
    }

    /* Texto "Cerrar Sesi√≥n" */
    .logout {
      color: white;
      text-decoration: none;
      font-size: 20px;
      align-self: flex-start;
      margin-top: auto;
      transition: opacity 0.3s ease;
      margin-left: 50px;
        font-weight: 600; /* üîπ m√°s negrilla */

    }

    .logout:hover {
      opacity: 0.8;
     
    }

    /* Panel blanco derecho */
    .content {
      flex: 1;
      background-color: white;
      border-top-left-radius: 15px;
      border-bottom-left-radius: 15px;
      margin: 20px 20px 20px 0;
      position: relative;
    }

    /* Icono de perfil */
    .profile-icon {
      position: absolute;
      top: 20px;
      right: 35px;
      font-size: 30px;
      color: black;
    }

    /* ------------------------ */
    /* ------------------------ */
    /* ------------------------ */

    /* üîù Contenedor superior: div azul + icono */
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 95%;
      margin: 30px auto 30px auto; /* espacio arriba y abajo */
    }

    /* Div azul redondeado */
    .header-box {
      flex: 1;
      background-color: #00839a;
      color: #fff;
      padding: 15px 30px;
      border-radius: 20px;
      font-size: 22px;
      font-weight: 600;
      letter-spacing: 0.5px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 85px; /* espacio con el icono */
    }

    /* Icono de perfil */
    .profile-icon {
      font-size: 42px;
      color: #000;
      cursor: pointer;
      margin-top: 9px;
    }

    /* 4Ô∏è‚É£ T√≠tulo inferior */
    .section-title {
      position: relative;
      top: 25px; /* üîº s√∫belo sin mover la tabla */
      margin: -15px 0 0 40px;
      font-size: 20px;
      font-weight: 700;
      color: #000;
    }

    /* TABLA DE DATOS */
    .registro-box2 {
      width: 95%;
      min-height: 520px;
      margin: 50px auto 40px auto;
      background-color: #ffffff;
      border: 1.5px solid #dcdcdc;
      border-radius: 15px;
      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
      padding: 20px;
      transition: box-shadow 0.3s ease;
    }

    .registro-box2:hover {
      box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
    }

    /* üß© FORMULARIO DE ACTUALIZACI√ìN */
    .form-actualizar {
      display: flex;
      flex-direction: column;
      gap: 20px;
      margin-top: 20px;
    }

    .form-row {
      display: flex;
      justify-content: space-between;
      gap: 20px;
    }

    .form-group {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .form-group label {
      font-weight: 600;
      margin-bottom: 5px;
      font-size: 15px;
    }

    .form-group input,
    .estado-select {
      padding: 10px 14px;
      border: 1.5px solid #bfbfbf;
      border-radius: 10px;
      font-size: 15px;
      width: 100%;
      background-color: #fff;
      outline: none;
      transition: border 0.3s;
    }

    .form-group input:focus,
    .estado-select:focus {
      border: 1.5px solid #00839a;
    }

    .estado-select {
      appearance: none;
      cursor: pointer;
      background-color: #f7f7f7;
    }

    .estado-row {
      align-items: flex-end;
    }

    .botones {
      display: flex;
      gap: 15px;
      align-items: center;
      justify-content: flex-end; /* üîπ Los empuja hacia la derecha */
      margin-right: 390px; /* üîπ Ajusta este valor seg√∫n lo necesites */
    }

    /* üíæ Botones */
    .btn-guardar,
    .btn-cancelar {
      padding: 10px 30px;
      border: none;
      border-radius: 30px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: 0.3s;
      margin-top: 45px;
      margin-left: 30px;
    }

    .btn-guardar {
      background-color: #00839a;
      color: #fff;
    }

    .btn-guardar:hover {
      background-color: #006f83;
      transform: translateY(-2px);
    }

    .btn-cancelar {
      background-color: #6e6e6e;
      color: #fff;
    }

    .btn-cancelar:hover {
      background-color: #555;
      transform: translateY(-2px);
    }

    /* Estilos para el prompt overlay */
    .prompt-overlay {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0,0,0,0.55);
      z-index: 99999;
      padding: 20px;
    }

    .error-message {
      color: #d32f2f;
      text-align: center;
      padding: 20px;
      font-size: 16px;
    }
  </style>
</head>

<body>
  <div class="main-container">
  
    <div class="sidebar">
      <div>
        <div class="logo-section">
          <img src="../../Assets/LOGOINGRESAR.png" alt="KonCheck logo" class="logo" />
          <h2 class="app-name">KonCheck</h2>
        </div>

        <button class="menu-button">
          <span class="icon">üîí </span> Ciudadanos  
        </button>
      </div>

       <a href="../../LandingPage.html" class="logout">Cerrar Sesi√≥n</a>
    </div>


    <div class="content">
      
      <div class="top-bar">
        <div class="header-box">
          Gesti√≥n de Ciudadanos
        </div>
        <div class="profile-icon">üë§</div>
      </div>


      <h2 class="section-title">Crear Ciudadano</h2>

      <div class="registro-box2">
        <form class="form-actualizar" id="formCrear">
        
          <div class="form-row">
            <div class="form-group">
              <label>Identificaci√≥n</label>
              <input type="text" name="identificacion" placeholder="1088765432 (10 d√≠gitos)" maxlength="10" />
            </div>
            <div class="form-group">
              <label>Nombres</label>
              <input type="text" name="nombres" placeholder="Juan" />
            </div>
            <div class="form-group">
              <label>Apellidos</label>
              <input type="text" name="apellidos" placeholder="Perez" />
            </div>
          </div>

        
          <div class="form-row">
            <div class="form-group">
              <label>Fecha de nacimiento</label>
              <input type="date" name="fechaNacimiento" />
            </div>
            <div class="form-group">
              <label>Lugar de nacimiento</label>
              <input type="text" name="lugarNacimiento" placeholder="Bogot√°" />
            </div>
            <div class="form-group">
              <label>RH</label>
              <input type="text" name="rh" placeholder="O+" />
            </div>
          </div>

     
          <div class="form-row">
            <div class="form-group">
              <label>Fecha de expedici√≥n</label>
              <input type="date" name="fechaExpedicion" />
            </div>
            <div class="form-group">
              <label>Lugar de expedici√≥n</label>
              <input type="text" name="lugarExpedicion" placeholder="Bogot√°" />
            </div>
            <div class="form-group">
              <label>Estatura (m)</label>
              <input type="text" name="estatura" placeholder="1.86" />
            </div>
          </div>

        
          <div class="form-row estado-row">
            <div class="form-group">
              <label>Estado</label>
              <select name="estado" class="estado-select">
                <option value="">Seleccione un estado</option>
                <option value="No Requerido">üü¢ No Requerido</option>
                <option value="Requerido">üî¥ Requerido</option>
              </select>
            </div>
          </div>

       
          <div class="botones">
            <button type="submit" class="btn-guardar">Guardar</button>
            <button type="button" class="btn-cancelar" onclick="mostrarCancelarPrompt()">Cancelar</button>
          </div>
        </form>
      </div>

      <script>
        document.addEventListener('DOMContentLoaded', () => {
          const form = document.getElementById('formCrear');

          // Guardar cambios con validaciones visuales
          form.addEventListener('submit', (e) => {
            e.preventDefault();

            // Eliminar mensajes de error previos
            form.querySelectorAll('.error-text').forEach(el => el.remove());
            form.querySelectorAll('input, select').forEach(el => {
              el.style.borderColor = '#bfbfbf';
            });

            const identificacion = form.identificacion.value.trim();
            const nombres = form.nombres.value.trim();
            const apellidos = form.apellidos.value.trim();
            const fechaNacimiento = form.fechaNacimiento.value.trim();
            const lugarNacimiento = form.lugarNacimiento.value.trim();
            const rh = form.rh.value.trim().toUpperCase();
            const fechaExpedicion = form.fechaExpedicion.value.trim();
            const lugarExpedicion = form.lugarExpedicion.value.trim();
            const estatura = form.estatura.value.trim();
            const estado = form.estado.value.trim();

            const rhValidos = ["A+", "A-", "B+", "B-", "AB+", "AB-", "O+", "O-"];
            let valido = true;

            // Funci√≥n auxiliar para mostrar errores
            const mostrarError = (campo, mensaje) => {
              campo.style.borderColor = '#d32f2f';
              const error = document.createElement('div');
              error.className = 'error-text';
              error.textContent = mensaje;
              Object.assign(error.style, {
                color: '#d32f2f',
                fontSize: '13px',
                marginTop: '4px',
                marginLeft: '2px'
              });
              campo.insertAdjacentElement('afterend', error);
              valido = false;
            };

            // üîπ Validaciones campo por campo
            if (!identificacion) mostrarError(form.identificacion, "Campo obligatorio.");
            else if (!/^\d+$/.test(identificacion)) mostrarError(form.identificacion, "Solo n√∫meros permitidos.");
            else if (identificacion.length !== 10) mostrarError(form.identificacion, "Debe tener exactamente 10 d√≠gitos.");

            if (!nombres) mostrarError(form.nombres, "Campo obligatorio.");
            else if (!/^[a-zA-Z√Å√â√ç√ì√ö√°√©√≠√≥√∫√±√ë\s]+$/.test(nombres)) mostrarError(form.nombres, "Solo letras permitidas.");

            if (!apellidos) mostrarError(form.apellidos, "Campo obligatorio.");
            else if (!/^[a-zA-Z√Å√â√ç√ì√ö√°√©√≠√≥√∫√±√ë\s]+$/.test(apellidos)) mostrarError(form.apellidos, "Solo letras permitidas.");

            if (!fechaNacimiento) mostrarError(form.fechaNacimiento, "Campo obligatorio.");

            if (!lugarNacimiento) mostrarError(form.lugarNacimiento, "Campo obligatorio.");
            else if (!/^[a-zA-Z√Å√â√ç√ì√ö√°√©√≠√≥√∫√±√ë\s]+$/.test(lugarNacimiento)) mostrarError(form.lugarNacimiento, "Solo letras permitidas.");

            if (!rh) mostrarError(form.rh, "Campo obligatorio.");
            else if (!rhValidos.includes(rh)) mostrarError(form.rh, "Valor inv√°lido. Ej: O+, A-, AB+...");

            if (!fechaExpedicion) mostrarError(form.fechaExpedicion, "Campo obligatorio.");

            if (!lugarExpedicion) mostrarError(form.lugarExpedicion, "Campo obligatorio.");
            else if (!/^[a-zA-Z√Å√â√ç√ì√ö√°√©√≠√≥√∫√±√ë\s]+$/.test(lugarExpedicion)) mostrarError(form.lugarExpedicion, "Solo letras permitidas.");

            if (!estatura) mostrarError(form.estatura, "Campo obligatorio.");

            if (!estado) mostrarError(form.estado, "Debe seleccionar un estado.");

            if (!valido) return; // üö´ Detiene el guardado si hay errores

            // ‚úÖ Si todo est√° bien, guardar normalmente
            const ciudadanos = JSON.parse(localStorage.getItem('ciudadanos')) || [];

            const nuevoCiudadano = {
              identificacion,
              nombres,
              apellidos,
              fechaNacimiento,
              lugarNacimiento,
              rh,
              fechaExpedicion,
              lugarExpedicion,
              estatura,
              estadoJudicial: estado
            };

            ciudadanos.push(nuevoCiudadano);
            localStorage.setItem('ciudadanos', JSON.stringify(ciudadanos));

            // Mostrar overlay de √©xito
            mostrarOperacionExitosaPrompt();
          });

          // Limpiar errores al escribir
          form.querySelectorAll('input, select').forEach(campo => {
            campo.addEventListener('input', () => {
              campo.style.borderColor = '#bfbfbf';
              const error = campo.nextElementSibling;
              if (error && error.classList.contains('error-text')) {
                error.remove();
              }
            });
          });
        });

        // Funci√≥n para mostrar el prompt de cancelar
        function mostrarCancelarPrompt() {
          const path = '../Dashboard/PROMPTS/cancelarOperacion.html';

          // Cerrar overlay previo si existe
          const prev = document.querySelector('.prompt-overlay');
          if (prev) prev.remove();

          const overlay = document.createElement('div');
          overlay.className = 'prompt-overlay';
          Object.assign(overlay.style, {
            position: 'fixed',
            inset: '0',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            background: 'rgba(0,0,0,0.55)',
            zIndex: 99999,
            padding: '20px'
          });

          const caja = document.createElement('div');
          Object.assign(caja.style, {
            position: 'relative',
            width: '720px',
            maxWidth: '95vw',
            height: '70vh',
            maxHeight: '90vh',
            borderRadius: '12px',
            overflow: 'hidden',
            boxShadow: '0 8px 30px rgba(0,0,0,0.4)',
            background: '#fff'
          });

          const closeBtn = document.createElement('button');
          closeBtn.innerHTML = '&times;';
          Object.assign(closeBtn.style, {
            position: 'absolute',
            top: '10px',
            right: '12px',
            zIndex: 10,
            fontSize: '28px',
            background: 'transparent',
            border: 'none',
            cursor: 'pointer',
            color: '#333'
          });

          closeBtn.addEventListener('click', () => {
            overlay.remove();
          });

          const iframe = document.createElement('iframe');
          iframe.src = path;
          Object.assign(iframe.style, {
            width: '100%',
            height: '100%',
            border: '0',
            display: 'block'
          });

          // Manejar errores de carga del iframe
          iframe.addEventListener('load', function() {
            console.log('Iframe cargado correctamente');
          });

          iframe.addEventListener('error', function() {
            console.error('Error cargando el iframe con ruta:', path);
            // Mostrar mensaje de error
            caja.innerHTML = `
              <div class="error-message">
                <h3>Error al cargar el formulario de cancelaci√≥n</h3>
                <p>No se pudo encontrar el archivo: ${path}</p>
                <button onclick="this.parentElement.parentElement.remove()" style="margin-top: 10px; padding: 8px 16px; background: #00839a; color: white; border: none; border-radius: 5px; cursor: pointer;">Cerrar</button>
              </div>
            `;
          });

          overlay.addEventListener('click', (ev) => {
            if (ev.target === overlay) {
              overlay.remove();
            }
          });

          caja.appendChild(closeBtn);
          caja.appendChild(iframe);
          overlay.appendChild(caja);
          document.body.appendChild(overlay);
        }

        // Funci√≥n para mostrar el prompt de operaci√≥n exitosa
        function mostrarOperacionExitosaPrompt() {
          const path = '../Dashboard/PROMPTS/operacionExitosa.html';

          // Cerrar overlay previo si existe
          const prev = document.querySelector('.prompt-overlay');
          if (prev) prev.remove();

          const overlay = document.createElement('div');
          overlay.className = 'prompt-overlay';
          Object.assign(overlay.style, {
            position: 'fixed',
            inset: '0',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            background: 'rgba(0,0,0,0.55)',
            zIndex: 99999,
            padding: '20px'
          });

          const caja = document.createElement('div');
          Object.assign(caja.style, {
            position: 'relative',
            width: '720px',
            maxWidth: '95vw',
            height: '70vh',
            maxHeight: '90vh',
            borderRadius: '12px',
            overflow: 'hidden',
            boxShadow: '0 8px 30px rgba(0,0,0,0.4)',
            background: '#fff'
          });

          const closeBtn = document.createElement('button');
          closeBtn.innerHTML = '&times;';
          Object.assign(closeBtn.style, {
            position: 'absolute',
            top: '10px',
            right: '12px',
            zIndex: 10,
            fontSize: '28px',
            background: 'transparent',
            border: 'none',
            cursor: 'pointer',
            color: '#333'
          });

          // üîπ Al cerrar el prompt, redirigir al dashboard
          closeBtn.addEventListener('click', () => {
            overlay.remove();
            window.location.href = '../Dashboard/dashboard.html';
          });

          const iframe = document.createElement('iframe');
          iframe.src = path;
          Object.assign(iframe.style, {
            width: '100%',
            height: '100%',
            border: '0',
            display: 'block'
          });

          iframe.addEventListener('error', function() {
            console.error('Error cargando el iframe:', path);
          });

          overlay.addEventListener('click', (ev) => {
            if (ev.target === overlay) {
              overlay.remove();
              window.location.href = '../Dashboard/dashboard.html';
            }
          });

          caja.appendChild(closeBtn);
          caja.appendChild(iframe);
          overlay.appendChild(caja);
          document.body.appendChild(overlay);
        }

        // Escuchar mensajes desde los iframes
        window.addEventListener('message', (ev) => {
          const data = ev.data;
          if (!data || !data.action) return;

          console.log('Mensaje recibido:', data);

          if (data.action === 'closePrompt') {
            // Cerrar el overlay cuando se selecciona "No" en cancelarOperacion
            const overlay = document.querySelector('.prompt-overlay');
            if (overlay) overlay.remove();
          } else if (data.action === 'confirmCancel') {
            // Cuando se selecciona "S√ç" en cancelarOperacion - ir al dashboard
            const overlay = document.querySelector('.prompt-overlay');
            if (overlay) overlay.remove();
            window.location.href = '../Dashboard/dashboard.html';
          }
        });
      </script>
    </div>
  </div>
</body>
</html>
